<!DOCTYPE html>
<html lang="tr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AITruthGuard Chat</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&family=Montserrat:wght@400;600&display=swap" rel="stylesheet">
    <style>
      :root {
        --bg: #0f0a0a;
        --panel: #1a0f0f;
        --muted: #b8a0a0;
        --red: #ef4444; /* primary */
        --red-600: #dc2626; /* darker buttons */
        --red-700: #b91c1c; /* hover */
        --bubble-user: #b91c1c;
        --bubble-bot: #241112;
        --ring: #7f1d1d;
        --white: #ffffff;
        --shadow: 0 10px 30px rgba(0,0,0,0.25);
      }
      * { box-sizing: border-box; }
      body { font-family: Poppins, Montserrat, Inter, system-ui, -apple-system, Segoe UI, Roboto, sans-serif; background: var(--bg); color: var(--white); margin: 0; }
      .app { min-height: 100vh; display: flex; flex-direction: column; align-items: center; justify-content: flex-start; padding: 24px 16px; gap: 20px; }
      .hero { display: flex; flex-direction: row; align-items: center; justify-content: center; gap: 14px; margin-top: 4px; text-align: center; }
      .hero .logo { width: 140px; max-width: 28vw; height: auto; filter: drop-shadow(0 8px 24px rgba(239,68,68,.25)); }
      .hero .side { font-weight: 700; font-size: 24px; letter-spacing: .6px; color: #fde2e2; text-transform: none; }
      .hero .side-left { color: #ffd9d9; }
      .hero .side-right { color: #ffb3b3; }
      .container { width: 100%; max-width: 1100px; display: flex; align-items: center; justify-content: center; }
      .chat-card { width: 100%; max-width: 960px; background: var(--panel); border: 1px solid #2b1717; border-radius: 16px; display: flex; flex-direction: column; min-height: 70vh; height: 80vh; box-shadow: var(--shadow); overflow: hidden; }
      .messages { flex: 1; padding: 16px; padding-bottom: 0; overflow-y: auto; display: flex; flex-direction: column; gap: 12px; scroll-behavior: smooth; }
      .msg-row { display: flex; gap: 8px; }
      .msg-row.user { justify-content: flex-end; }
      .msg { max-width: min(80%, 720px); padding: 12px 14px; border-radius: 14px; box-shadow: var(--shadow); position: relative; opacity: 0; transform: translateY(6px); animation: fadeIn .25s ease forwards; }
      .msg.user { background: linear-gradient(180deg, var(--bubble-user), #7f1d1d); border: 1px solid #6b1a1a; color: #fff; border-top-right-radius: 4px; }
      .msg.bot { background: linear-gradient(180deg, var(--bubble-bot), #15090a); border: 1px solid #3a1617; color: #fceaea; border-top-left-radius: 4px; }
      .msg small { display: block; color: var(--muted); margin-top: 6px; font-size: 11px; }
      .composer { border-top: 1px solid #2b1717; padding: 12px; display: grid; grid-template-columns: 1fr auto; gap: 10px; background: linear-gradient(180deg, rgba(36,17,18,0.65), rgba(26,15,15,0.9)); }
      .input { width: 100%; background: #140b0b; border: 1px solid #351111; color: var(--white); padding: 12px 12px; border-radius: 12px; outline: none; transition: border-color .2s, box-shadow .2s; }
      .input:focus { border-color: var(--red); box-shadow: 0 0 0 3px rgba(239,68,68,.25); }
      .btn { appearance: none; border: 1px solid #661414; color: #fff; background: linear-gradient(180deg, var(--red-600), var(--red-700)); padding: 10px 14px; border-radius: 12px; cursor: pointer; font-weight: 600; transition: transform .04s ease, filter .15s ease, box-shadow .15s ease; box-shadow: 0 8px 16px rgba(185,28,28,.25); }
      .btn:hover { filter: brightness(1.05); box-shadow: 0 12px 24px rgba(185,28,28,.35); }
      .btn:active { transform: translateY(1px); }
      .btn.secondary { background: #fff; color: #7f1d1d; border: 1px solid #bfa4a4; box-shadow: 0 8px 16px rgba(255,255,255,.08); }
      .btn.secondary:hover { filter: none; box-shadow: 0 12px 24px rgba(255,255,255,.12); }
      .typing { display: inline-flex; align-items: center; gap: 6px; padding: 8px 10px; border-radius: 999px; border: 1px solid #3a1617; background: #1f1112; color: #ffdbdb; box-shadow: var(--shadow); }
      .dot { width: 6px; height: 6px; border-radius: 999px; background: var(--red); opacity: .65; animation: blink 1.2s infinite ease-in-out; }
      .dot:nth-child(2){ animation-delay: .2s; }
      .dot:nth-child(3){ animation-delay: .4s; }
      @keyframes blink { 0%, 80%, 100% { opacity: .2 } 40% { opacity: 1 } }
      @keyframes fadeIn { from { opacity: 0; transform: translateY(6px) } to { opacity: 1; transform: translateY(0) } }
      @media (max-width: 640px) {
        .hero .logo { width: 112px; }
        .hero .side { font-size: 18px; }
        .chat-card { height: calc(100vh - 60px); min-height: 0; max-width: 100%; }
        .msg { max-width: 88%; }
        .composer { grid-template-columns: 1fr auto; }
        .btn.secondary { display: none; }
      }
    </style>
  </head>
  <body>
    <div id="root" class="app"></div>

    <!-- React and ReactDOM via CDN -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script>
      const { useEffect, useMemo, useRef, useState } = React;

      function TypingIndicator() {
        return (
          React.createElement('div', { className: 'typing' },
            React.createElement('span', { className: 'dot' }),
            React.createElement('span', { className: 'dot' }),
            React.createElement('span', { className: 'dot' })
          )
        );
      }

      function MessageBubble({ role, text, meta }) {
        return (
          React.createElement('div', { className: 'msg-row ' + role },
            React.createElement('div', { className: 'msg ' + role },
              React.createElement('div', null, text),
              meta ? React.createElement('small', null, meta) : null
            )
          )
        );
      }

      function ChatApp() {
        const apiBase = 'https://aitruthguard-backend.onrender.com';
        const [input, setInput] = useState('');
        const [isSending, setIsSending] = useState(false);
        const [messages, setMessages] = useState([
          { role: 'bot', text: 'Merhaba! Bir haber metni paylaş, doğrulayalım.' }
        ]);
        const viewportRef = useRef(null);

        useEffect(() => {
          if (viewportRef.current) {
            viewportRef.current.scrollTop = viewportRef.current.scrollHeight;
          }
        }, [messages, isSending]);

        async function sendMessage() {
          const trimmed = input.trim();
          if (!trimmed || isSending) return;
          const userMsg = { role: 'user', text: trimmed };
          setMessages(prev => [...prev, userMsg]);
          setInput('');
          setIsSending(true);
          try {
            const resp = await fetch(`${apiBase}/ask`, {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ query: trimmed })
            });
            if (!resp.ok) throw new Error('API error');
            const data = await resp.json();
            const botText = (data && data.answer) ? data.answer : 'Yanıt alınamadı.';
            const meta = (data && typeof data.confidence === 'number') ? `Güven: ${data.confidence.toFixed(2)}` : '';
            setMessages(prev => [...prev, { role: 'bot', text: botText, meta }]);
          } catch (err) {
            setMessages(prev => [...prev, { role: 'bot', text: `Hata: ${err.message}` }]);
          } finally {
            setIsSending(false);
          }
        }

        function handleKeyDown(e) {
          if (e.key === 'Enter' && !e.shiftKey) {
            e.preventDefault();
            sendMessage();
          }
        }

        function clearConversation() {
          setMessages([{ role: 'bot', text: 'Sohbet temizlendi. Yeni bir metin gönder.' }]);
        }

        return (
          React.createElement(React.Fragment, null,
            React.createElement('div', { className: 'hero' },
              React.createElement('div', { className: 'side side-left' }, 'AI'),
              React.createElement('img', { className: 'logo', src: './truthLogo.png', alt: 'Truth logo' }),
              React.createElement('div', { className: 'side side-right' }, 'Guard')
            ),
            React.createElement('div', { className: 'container' },
              React.createElement('div', { className: 'chat-card' },
                React.createElement('div', { className: 'messages', ref: viewportRef },
                  messages.map((m, i) => (
                    React.createElement(MessageBubble, { key: i, role: m.role, text: m.text, meta: m.meta })
                  )),
                  isSending ? React.createElement('div', { className: 'msg-row bot' },
                    React.createElement('div', { className: 'msg bot' },
                      React.createElement(TypingIndicator, null)
                    )
                  ) : null
                ),
                React.createElement('div', { className: 'composer' },
                  React.createElement('textarea', {
                    className: 'input',
                    rows: 1,
                    placeholder: 'Haber metnini yazın ve Enter ile gönderin... (Shift+Enter yeni satır)',
                    value: input,
                    onChange: (e) => setInput(e.target.value),
                    onKeyDown: handleKeyDown
                  }),
                  React.createElement('button', { className: 'btn secondary', onClick: clearConversation, disabled: isSending }, 'Temizle'),
                  React.createElement('button', { className: 'btn', onClick: sendMessage, disabled: isSending || !input.trim() }, 'Gönder')
                )
              )
            )
          )
        );
      }

      const root = ReactDOM.createRoot(document.getElementById('root'));
      root.render(React.createElement(ChatApp));
    </script>
  </body>
  </html>


